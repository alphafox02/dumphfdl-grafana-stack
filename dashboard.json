{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": { "type": "grafana", "uid": "-- Grafana --" },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": 0,
  "links": [],
  "panels": [
    {
      "datasource": { "type": "graphite", "uid": "$DS_GRAPHITE" },
      "fieldConfig": {
        "defaults": {
          "decimals": 1,
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] },
          "unit": "ops"
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 12, "x": 0, "y": 0 },
      "id": 1,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": { "calcs": [ "lastNotNull" ], "fields": "", "values": false },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.2.0",
      "targets": [ { "refId": "A", "target": "sumSeries(scale(stats_counts.dumphfdl*.channels.*.frames.good,0.1))" } ],
      "title": "HFDL msg/s",
      "type": "stat"
    },
    {
      "datasource": { "type": "graphite", "uid": "$DS_GRAPHITE" },
      "fieldConfig": {
        "defaults": {
          "decimals": 1,
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] },
          "unit": "ops"
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 12, "x": 12, "y": 0 },
      "id": 2,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": { "calcs": [ "lastNotNull" ], "fields": "", "values": false },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.2.0",
      "targets": [ { "refId": "A", "target": "sumSeries(scale(stats_counts.dumpvdl2*.*.decoder.msg.good,0.1))" } ],
      "title": "VDL2 msg/s",
      "type": "stat"
    },
    {
      "datasource": { "type": "graphite", "uid": "$DS_GRAPHITE" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "auto",
            "showValues": false,
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] }
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 4 },
      "id": 3,
      "options": {
        "legend": { "calcs": [], "displayMode": "table", "placement": "bottom", "showLegend": true },
        "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" }
      },
      "pluginVersion": "12.2.0",
      "targets": [ { "refId": "A", "target": "alias(sumSeries(scale(stats_counts.dumphfdl*.channels.*.frames.good,0.1)),'HFDL total')" } ],
      "title": "HFDL: Total frames/sec (all channels)",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "graphite", "uid": "$DS_GRAPHITE" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "auto",
            "showValues": false,
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] }
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 4 },
      "id": 4,
      "options": {
        "legend": { "calcs": [], "displayMode": "table", "placement": "bottom", "showLegend": true },
        "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" }
      },
      "pluginVersion": "12.2.0",
      "targets": [ { "refId": "A", "target": "alias(sumSeries(scale(stats_counts.dumpvdl2*.*.decoder.msg.good,0.1)),'VDL2 total')" } ],
      "title": "VDL2: Total messages/sec (all freqs)",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "graphite", "uid": "$DS_GRAPHITE" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "auto",
            "showValues": false,
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] }
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 12 },
      "id": 5,
      "options": {
        "legend": { "calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true },
        "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" }
      },
      "pluginVersion": "12.2.0",
      "targets": [ { "refId": "A", "target": "highestAverage(movingAverage(scale(stats_counts.dumphfdl*.channels.*.frames.good,0.1),'15min'),5)" } ],
      "title": "HFDL: Top 5 channels (15m avg)",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "graphite", "uid": "$DS_GRAPHITE" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "auto",
            "showValues": false,
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] }
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 12 },
      "id": 6,
      "options": {
        "legend": { "calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true },
        "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" }
      },
      "pluginVersion": "12.2.0",
      "targets": [ { "refId": "A", "target": "highestAverage(movingAverage(scale(stats_counts.dumpvdl2*.*.decoder.msg.good,0.1),'15min'),5)" } ],
      "title": "VDL2: Top 5 freqs (15m avg)",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "loki", "uid": "$DS_LOKI" },
      "fieldConfig": { "defaults": {}, "overrides": [] },
      "gridPos": { "h": 12, "w": 12, "x": 0, "y": 20 },
      "id": 7,
      "options": {
        "dedupStrategy": "none",
        "enableInfiniteScrolling": false,
        "enableLogDetails": true,
        "prettifyLogMessage": false,
        "showCommonLabels": false,
        "showLabels": false,
        "showTime": false,
        "sortOrder": "Descending",
        "wrapLogMessage": true
      },
      "pluginVersion": "12.2.0",
      "targets": [ { "expr": "{job=\"dumphfdl\",freq=~\"${freq:regex}\",dst_name=~\"${dst_name:regex}\"}", "refId": "A" } ],
      "title": "HFDL logs (filter by freq & ground station)",
      "type": "logs"
    },
    {
      "datasource": { "type": "loki", "uid": "$DS_LOKI" },
      "fieldConfig": { "defaults": {}, "overrides": [] },
      "gridPos": { "h": 12, "w": 12, "x": 12, "y": 20 },
      "id": 8,
      "options": {
        "dedupStrategy": "none",
        "enableInfiniteScrolling": false,
        "enableLogDetails": true,
        "prettifyLogMessage": false,
        "showCommonLabels": false,
        "showLabels": false,
        "showTime": false,
        "sortOrder": "Descending",
        "wrapLogMessage": true
      },
      "pluginVersion": "12.2.0",
      "targets": [ { "expr": "{job=\"dumpvdl2\",freq=~\"${vdl2_freq:regex}\"}", "refId": "A" } ],
      "title": "VDL2 logs (filter by freq; ACARS flight optional)",
      "type": "logs"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 32 },
      "id": 9,
      "panels": [],
      "title": "Maps (toggle open)",
      "type": "row"
    },
    {
      "datasource": { "type": "loki", "uid": "$DS_LOKI" },
      "fieldConfig": {
        "defaults": {
          "custom": { "hideFrom": { "legend": false, "tooltip": false, "viz": false } },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "freq" },
            "properties": [
              {
                "id": "links",
                "value": [
                  {
                    "title": "Open raw log in Explore",
                    "url": "/explore?left={\"datasource\":\"$DS_LOKI\",\"queries\":[{\"refId\":\"A\",\"expr\":\"{job=\\\"dumpvdl2\\\"} |= \\\"ac_location\\\" |~ \\\"${__data.fields.lat_str}\\\" |~ \\\"${__data.fields.lon_str}\\\"\",\"queryType\":\"range\"}],\"range\":{\"from\":\"${__from}\",\"to\":\"${__to}\"}}",
                    "targetBlank": true
                  }
                ]
              }
            ]
          }
        ]
      },
      "gridPos": { "h": 12, "w": 24, "x": 0, "y": 33 },
      "id": 10,
      "options": {
        "basemap": { "type": "default" },
        "controls": { "mouseWheelZoom": true, "showAttribution": true, "showDebug": false, "showMeasure": false, "showScale": false, "showZoom": true },
        "layers": [
          {
            "config": {
              "color": { "fixed": "#00A3FF", "mode": "fixed" },
              "data": { "refId": "A" },
              "location": { "latField": "latitude", "lonField": "longitude", "mode": "coords" },
              "opacity": 0.5,
              "showLegend": true,
              "size": 6,
              "style": { "opacity": 0.5 },
              "tooltip": { "mode": "fields", "fields": [ "latitude", "longitude", "freq" ] }
            },
            "name": "VDL2 positions (ACARS when present) markers",
            "style": { "color": { "fixed": "#00A3FF" }, "size": { "fixed": 6 } },
            "type": "markers"
          }
        ],
        "tooltip": { "mode": "fields" },
        "view": { "allLayers": true, "data": { "mode": "all-layers" }, "id": "fit", "lat": 0, "lon": 0, "maxZoom": 6, "noRepeat": false, "padding": 0.1, "zoom": 1 }
      },
      "pluginVersion": "12.2.0",
      "targets": [
        {
          "direction": "backward",
          "editorMode": "code",
          "expr": "{job=\"dumpvdl2\", freq=~\"${vdl2_freq:regex}\"} |= \"ac_location\" | regexp \"lat\\\\\\\"\\\\s*:\\\\s*(?P<latitude>-?[0-9]{1,3}(?:\\\\.[0-9]{1,8})?)\\\\s*,\\\\s*\\\\\\\"lon\\\\\\\"\\\\s*:\\\\s*(?P<longitude>-?[0-9]{1,3}(?:\\\\.[0-9]{1,8})?)\" | line_format \"{\\\"latitude\\\": {{ .latitude }}, \\\"longitude\\\": {{ .longitude }}, \\\"lat_str\\\": \\\"{{ .latitude }}\\\", \\\"lon_str\\\": \\\"{{ .longitude }}\\\", \\\"freq\\\": {{ .freq }}}\"",
          "queryType": "range",
          "refId": "A"
        }
      ],
      "title": "VDL2 positions (ACARS when present)",
      "transformations": [
        { "id": "extractFields", "options": { "format": "json", "source": "line" } },
        { "id": "extractFields", "options": { "format": "json", "source": "Line" } },
        { "id": "convertFieldType", "options": { "conversions": [ { "destinationType": "number", "targetField": "latitude" }, { "destinationType": "number", "targetField": "longitude" } ] } }
      ],
      "type": "geomap"
    },
    {
      "datasource": { "type": "loki", "uid": "$DS_LOKI" },
      "fieldConfig": {
        "defaults": {
          "custom": { "hideFrom": { "legend": false, "tooltip": false, "viz": false } },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "flight" },
            "properties": [
              {
                "id": "links",
                "value": [
                  {
                    "title": "Open log in Explore",
                    "url": "/explore?left={\"datasource\":\"$DS_LOKI\",\"queries\":[{\"refId\":\"A\",\"expr\":\"{job=\\\"dumphfdl\\\"} |~ \\\"${__value.raw}\\\"\"}],\"range\":{\"from\":\"${__from}\",\"to\":\"${__to}\"}}",
                    "targetBlank": true
                  }
                ]
              }
            ]
          }
        ]
      },
      "gridPos": { "h": 12, "w": 24, "x": 0, "y": 45 },
      "id": 11,
      "options": {
        "basemap": { "name": "Layer 0", "noRepeat": false, "type": "default" },
        "controls": { "mouseWheelZoom": true, "showAttribution": true, "showDebug": false, "showMeasure": false, "showScale": false, "showZoom": true },
        "layers": [
          {
            "config": {
              "color": { "fixed": "#00FF55", "mode": "fixed" },
              "data": { "refId": "A" },
              "location": { "latField": "latitude", "lonField": "longitude", "mode": "coords" },
              "opacity": 0.5,
              "showLegend": true,
              "size": 6,
              "style": { "opacity": 0.5 },
              "tooltip": { "fields": [ "flight", "latitude", "longitude", "freq", "dst_name", "sig_db" ], "mode": "details" }
            },
            "name": "HFDL positions markers",
            "style": { "color": { "fixed": "#00FF55" }, "size": { "fixed": 6 } },
            "type": "markers"
          }
        ],
        "tooltip": { "mode": "details" },
        "view": { "allLayers": true, "data": { "mode": "all-layers" }, "id": "fit", "lat": 0, "lon": 0, "maxZoom": 6, "noRepeat": false, "padding": 0.1, "zoom": 1 }
      },
      "pluginVersion": "12.2.0",
      "targets": [
        {
          "direction": "backward",
          "editorMode": "code",
          "expr": "{job=\"dumphfdl\"}\n| json\n| line_format \"{\\\"lat\\\": {{ or .hfdl_lpdu_hfnpdu_pos_lat .pos_lat .lat }}, \\\"lon\\\": {{ or .hfdl_lpdu_hfnpdu_pos_lon .pos_lon .lon }}, \\\"flight\\\": \\\"{{ or .hfdl_lpdu_hfnpdu_flight_id .flight_id }}\\\" }\"\n",
          "queryType": "range",
          "refId": "A"
        }
      ],
      "title": "HFDL positions",
      "transformations": [
        { "id": "extractFields", "options": { "format": "json", "source": "line" } },
        { "id": "extractFields", "options": { "format": "json", "source": "Line" } },
        { "id": "convertFieldType", "options": { "conversions": [ { "destinationType": "number", "targetField": "lat" }, { "destinationType": "number", "targetField": "lon" } ], "fields": {} } },
        { "id": "organize", "options": { "excludeByName": { "Line": true, "id": true, "labelTypes": true, "labels": true, "line": true, "tsNs": true }, "renameByName": { "lat": "latitude", "lon": "longitude" } } }
      ],
      "type": "geomap"
    }
  ],
  "preload": false,
  "refresh": "10s",
  "schemaVersion": 42,
  "tags": [ "hfdl", "dumphfdl", "vdl2", "dumpvdl2", "graphite", "loki" ],
  "templating": {
    "list": [
      { "current": { "text": "graphite", "value": "ef0s7h4vpezgge" }, "label": "Graphite datasource", "name": "DS_GRAPHITE", "options": [], "query": "graphite", "refresh": 1, "type": "datasource" },
      { "current": { "text": "loki", "value": "df0s7i5kx7jlsf" }, "label": "Loki datasource", "name": "DS_LOKI", "options": [], "query": "loki", "refresh": 1, "type": "datasource" },
      { "current": { "text": "All", "value": [ "$__all" ] }, "datasource": { "type": "loki", "uid": "$DS_LOKI" }, "includeAll": true, "label": "HFDL Frequency (Loki label)", "multi": true, "name": "freq", "options": [], "query": { "expr": "{job=\"dumphfdl\"}", "label": "freq", "queryType": "label_values", "refId": "A" }, "refresh": 2, "type": "query" },
      { "current": { "text": "All", "value": [ "$__all" ] }, "datasource": { "type": "loki", "uid": "$DS_LOKI" }, "includeAll": true, "label": "HFDL Ground Station (Loki label)", "multi": true, "name": "dst_name", "options": [], "query": { "expr": "{job=\"dumphfdl\"}", "label": "dst_name", "queryType": "label_values", "refId": "A" }, "refresh": 2, "type": "query" },
      { "current": { "text": "All", "value": [ "$__all" ] }, "datasource": { "type": "loki", "uid": "$DS_LOKI" }, "includeAll": true, "label": "VDL2 Frequency (Loki label)", "multi": true, "name": "vdl2_freq", "options": [], "query": { "expr": "{job=\"dumpvdl2\"}", "label": "freq", "queryType": "label_values", "refId": "A" }, "refresh": 2, "type": "query" },
      { "current": { "text": "All", "value": [ "$__all" ] }, "datasource": { "type": "loki", "uid": "$DS_LOKI" }, "includeAll": true, "label": "VDL2 ACARS Flight (Loki label)", "multi": true, "name": "acars_flight", "options": [], "query": { "expr": "{job=\"dumpvdl2\"}", "label": "acars_flight", "queryType": "label_values", "refId": "A" }, "refresh": 2, "type": "query" }
    ]
  },
  "time": { "from": "now-6h", "to": "now" },
  "timepicker": { "refresh_intervals": [ "5s", "10s", "30s", "1m", "5m" ] },
  "timezone": "",
  "title": "HFDL + VDL2: Metrics + Logs + Map",
  "version": 1
}
